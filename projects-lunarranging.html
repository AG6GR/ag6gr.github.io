<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Lunar Ranging - Sunny He</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="/projects-lunarranging.html">

        <meta name="author" content="Sunny He" />
        <meta name="keywords" content="amateur radio,python,gnuradio" />
        <meta name="description" content="Pulse-doppler radar for astronomical measurements" />

        <meta property="og:site_name" content="Sunny He" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Lunar Ranging"/>
        <meta property="og:url" content="/projects-lunarranging.html"/>
        <meta property="og:description" content="Pulse-doppler radar for astronomical measurements"/>
        <meta property="article:published_time" content="2017-01-05" />
            <meta property="article:section" content="Projects" />
            <meta property="article:tag" content="amateur radio" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="gnuradio" />
            <meta property="article:author" content="Sunny He" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">
Sunny He            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="/category/projects.html">Projects</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/projects-lunarranging.html"
                       rel="bookmark"
                       title="Permalink to Lunar Ranging" style="color:black">
                        Lunar Ranging
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2017-01-05T12:00:00-05:00"> Thu 05 January 2017</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="/tag/amateur-radio.html">amateur radio</a>
        /
	<a href="/tag/python.html">python</a>
        /
	<a href="/tag/gnuradio.html">gnuradio</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><center><a target='_blank' href='/images/diana_site.jpg'><img width=30% src='/images/diana_site_small.jpg' alt='TLM-18 Dish at the Project Diana site'/></a></center></p>
<h1>Overview</h1>
<p>Juniors in the electrical engineering department at Princeton may elect to complete a semester long independent work project under the supervision of a faculty advisor. During the fall semester of 2016, I had the opportunity to work with Professor <a href="https://www.princeton.edu/physics/people/display_person.xml?netid=marlow&display=faculty" target="_blank">Dan Marlow</a> and Senior Research Physicist <a href="https://www.princeton.edu/physics/people/display_person.xml?netid=jarosik&display=Research%20Staff" target="_blank">Norm Jarosik</a> from the physics department on a project to conduct ranging measurements of the moon. This project included the design and implementation of RF systems to interface USRP software defined radios with the TLM-18 dish and the development of Python software to perform collection and post-processing of data.</p>
<p><a href="docs/Sunny_He_IWReport.pdf">Final Report</a></p>
<h3>Acknowledgments</h3>
<p>This project was supported by funding from the Princeton University Department of Electrical Engineering and the Princeton University School of Engineering and Applied Science (SEAS). In addition, many thanks to Professor <a href="http://ee.princeton.edu/people/faculty/david-wentzlaff" target="_blank">David Wentzlaff</a> (EE) and Professor <a href="https://www.princeton.edu/physics/people/display_person.xml?netid=joe&display=faculty" target="_blank">Joe Taylor</a> (Physics) for their valuable input and advice over the course of this project.</p>
<h1>RF System Design</h1>
<h2>Receive Hardware</h2>
<p><center><img width='75%' src='/images/rx_diag.png' alt='TLM-18 Receive path block diagram'/></br>
<i>Receive path block diagram</i>
</center></p>
<p>The TLM-18 antenna is an 18m-diameter microwave dish located at the former Project Diana site about 40 miles from campus. Prior to this independent work project, various faculty members refurbished the dish and installed hardware for making radio astronomy measurements at a 21cm wavelength. This existing hardware includes low-noise-amplifiers (LNA’s) and microwave filters for enabling the reception of weak signals.</p>
<h3>Transmit Hardware</h3>
<p><center><img width='75%' src='/images/tx_diag.png' alt='Transmit path block diagram'/></br>
<i>Transmit path block diagram</i>
</center></p>
<p>While the receive path of the TLM-18 antenna was already in place, additional hardware was necessary to enable transmit functionality. In particular, a series of microwave-frequency amplifiers were needed to increase the transmit power of the USRP radios. The USRP B210s being used have a transmit power output of about 10mW, while about 10W is required to drive the existing transmit power amplifier. </p>
<p><center><img width='50%' src='/images/amplifier_panel.jpg' alt='Amplifier panel under test'/></br>
<i>Amplifier panel under test</i>
</center></p>
<p>We ultimately selected a <a href='http://shop.kuhne-electronic.de/kuhne/en/shop/power-amplifiers/MKU+PA+23CM30W+HY++LDMOS+Power+Amplifier/?card=973' target="_blank">Kuhne MKU PA 23CM - 30W Power Amplifier</a>. Attenuators were added between the USRP and Kuhne amplifier to ensure the amplifier output would never exceed the 10W input limit. A RF patch panel allowed the output of the amplifier to be connected in place of the amateur radio tranceiver already installed at the site. </p>
<h3>Control Circuitry</h3>
<p>To disable the amplifier during receive, a small circuit was built to allow the USRP's built-in GPIO pins to toggle the 12V enable line on the Kuhne amplifier. This interface circuit output was also connected to the existing sequencer circuit, which controls the transmit-receive switches and high-power amplifiers.</p>
<h1>Transmit Waveform</h1>
<p>A literature review identified many different options for the transmitted waveform. Since the echo from the moon would be shifted a large amount both in time and in frequency, any coding scheme used needed to have good frequency-domain resolution as well as time-domain resolution. </p>
<p><center><img width='50%' src='/images/costas10_spec.png' alt='Costas-10 code spectrogram'/></br>
<i>Costas-10 code spectrogram</i>
</center></p>
<p>It was ultimately decided to use a class of codes known as Costas codes. These codes consist of a sequence of values, sent via FSK, with excellent correlation properties both in time and in frequency. The exact waveform used was a Costas-10 code using 10 distinct frequencies sent in a 0.1 sec interval.</p>
<p><center><img width='50%' src='/images/costas10_autocorrelation.png' alt='Costas-10 code time-domain autocorrlation'/></br>
<i>Costas-10 code time-domain autocorrelation</i>
</center></p>
<p>The complex waveform was generated and analyzed using the SciPy Python package.</p>
<h1>Radio Control</h1>
<p>Interfacing with the USRP B210 software defined radios was accomplished through the <a href="http://gnuradio.org/" target="_blank">GNURadio</a> open-source toolkit. A Python script coordinated the transmit-receive switching, waveform transmission, and data collection.</p>
<h1>Post-processing</h1>
<p><center><img width='50%' src='/images/a7_spectrogram_d40_annotated.png' alt='Example spectrogram of received data'/></br>
<i>Example spectrogram of received data</i>
</center></p>
<p>The echo from the moon could be clearly seen in the received data. Matched filtering was performed using SciPy to identify the transmitted waveform.</p>
<h2>Sample Rate Recovery</h2>
<p>During analysis it became evident that there was a major discrepancy in the sample timing. It appeared almost as if the samples were being recorded with half the specified sample rate. Further testing revealed that running the script with the GUI interface enabled was causing heavy load on the computer, leading to buffer overuns and dropped samples. </p>
<p>Given the limited time available, which precluded another recording session, we attempted to recover basic timing information from the recorded based on the delay between the start of recording and the start of transmission. By making the simplifying assumption that the packet loss happened at a consistent rate, missing samples could be modeled as a deviation in the sample rate.</p>
<h2>Timing Data</h2>
<p><center>
<table class="table table-hover">
<tr>
    <th>Trial Number</th>
    <th>Recovered "Actual" Sample Rate (Hz)</th>
    <th>Round trip time (sec)</th>
    <th>Earth-Moon Distance (km)</th>
</tr>
<tr>
    <td> 1 </td> <td> 656719 </td> <td> 2.307 </td> <td> 345839 </td><br>
</tr>
<tr>
    <td> 2 </td> <td> 656643 </td> <td> 2.308 </td> <td> 345921 </td>
</tr>
<tr>
    <td> 3 </td> <td> 662131 </td> <td> 2.307 </td> <td> 345814 </td>
</tr>
<tr>
    <td> 4 </td> <td> 642116 </td> <td> 2.388 </td> <td> 357998 </td>
</tr>
<tr>
    <td> 5  </td> <td> 643052 </td> <td> 2.364 </td> <td> 354283 </td>
</tr>
<tr>
    <td> 6 </td> <td> 650329 </td> <td> 2.345 </td> <td> 351518 </td>
</tr>
<tr>
    <td> 7 </td> <td> 649577 </td> <td> 2.343 </td> <td> 351194 </td>
</tr>
<tr>
    <td> 8 </td> <td> 660327 </td> <td> 2.307 </td> <td> 345768 </td>
</tr>
<tr>
    <td> 9 </td> <td> 641099 </td> <td> 2.380 </td> <td> 356727 </td>
</tr>
<tr>
    <td> 10 </td> <td> 661004 </td> <td> 2.253 </td> <td> 337681 </td>
</tr>
<tr>
    <th scope="row">Average</th> <td>  652300 </td> <td> 2.330 </td> <td> 349274</td>
</tr>
<tr>
    <th scope="row">2 sigma</th> <td> 16346 </td><td> 0.083 </td><td> 12422 </td>
</tr>
<caption>Round Trip Time and Distance Results</caption>
</table>
</center></p>
<h1>Conclusion</h1>
<p><center><img width='50%' src='/images/a8_range_doppler_t1850000_d5.png' alt='Example spectrogram of received data'/></br>
<i>Example range-doppler correlation output</i>
</center></p>
<p>The TLM-18 dish was successfully upgraded with the hardware systems necessary to perform ranging experiments at 23-cm wavelength. Averaging across ten trials, the round trip time for a signal to traverse the Earth-Moon-Earth path was measured to be 2.33±0.08 sec, corresponding to a Earth-Moon distance of 350000±10000 km. </p>
<p>Calculations based on accepted lunar orbit data place the  expected distance to the moon between 364043 and 364006 km during the observation period. As noted above, the likely source of this error is dropped samples due to excessive load on the computer running the USRP control scripts. Nevertheless, this result is remarkably close given the first-order approximation used to recover the sample rate.</p>
<p>Overall, this project demonstrates the viability of performing Earth-based active radar astronomy with relatively low-cost experimental setups. It is hoped that the methods used and problems encountered will be instructive for others seeking to begin their own foray into the field of radar astronomy.</p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; <script type="text/javascript">document.write(new Date().getFullYear());</script> Sunny He
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>

    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-109315919-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

</body>
</html>